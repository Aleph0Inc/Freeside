<%

my $classnum = $cgi->param('classnum');
$classnum =~ /^(\d+)$/ or eidiot "illegal classnum $classnum";
$classnum = $1;

my $inventory_class = qsearchs( {
  'table'     => 'inventory_class',
  'hashref'   => { 'classnum' => $classnum },
} );

my $title = $inventory_class->classname. ' Inventory';

#little false laziness with SQL fragments in inventory_class.pm
my $extra_sql = '';
if ( $cgi->param('avail') ) {
  $extra_sql = 'AND ( svcnum IS NULL OR svcnum = 0 )';
  $title .= ' - Available';
} elsif ( $cgi->param('used') ) {
  $extra_sql = 'AND svcnum IS NOT NULL AND svcnum > 0';
  $title .= ' - In use';
}

my $count_query =
  "SELECT COUNT(*) FROM inventory_item WHERE classnum = $classnum $extra_sql";

%><%= include( 'elements/search.html',
                 'title'       => $title,

                 #less lame to use Lingua:: something to pluralize
                 'name'        => $inventory_class->classname. 's',

                 'query'       => {
                                    'table'   => 'inventory_item',
                                    'hashref' => { 'classnum' => $classnum },
                                    'extra_sql' => $extra_sql,
                                  },

                 'count_query' => $count_query,

                 # XXX proper full service/customer link ala svc_acct
                 'header'      => [ '#', $inventory_class->classname, 'svcnum' ],

                 'fields'      => [
                   'itemnum',
                   'item',
                   'svcnum', #XXX proper full service customer link ala svc_acct
                             # "unallocated" ?  "available" ?
                 ],

             )
%>
