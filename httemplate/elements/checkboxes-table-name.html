<%doc>

Example:

  include( '/elements/checkboxes-table-name.html',

    ###
    # required
    ###
    'link_table'      => 'table_name',
   
    'name_col' => 'name_column',
    #or
    'name_callback' => sub { },
   
    'names_list' => [ 'value',
                      'other value',
                      [ 'complex value' => { 'desc' => "Add'l description",
                                             'note' => '&nbsp;*',
                                           }
                      ],
                    ],
   
    ###
    # recommended (required?)
    ###
    'source_obj'   => $obj,
    #or?
    #'source_table' => 'table_name',
    #'sourcenum'    => '4', #current value of primary key in source_table
    #                       # (none is okay, just pass it if you have it)

    ###
    # optional
    ###
    'num_col' => 'col_name' #if column name is different in link_table than
                            #source_table
    'link_static' => { 'column' => 'value' },

  )

</%doc>

<TABLE CELLSPACING=0 CELLPADDING=0>

<TR>
  <TD COLSPAN=2 ALIGN="center"><FONT SIZE="-1">(
    <A HREF="javascript:setAll<%$prefix%>(true)">select all</A> |
    <A HREF="javascript:setAll<%$prefix%>(false)">unselect all</A> |
    <A HREF="javascript:toggleAll<%$prefix%>()">toggle all</A>
  )</FONT></TD>
</TR>

% my $num=0;
% foreach my $item ( @{ $opt{'names_list'} } ) {
%
%     my $name = ref($item) ? $item->[0] : $item;
%     ( my $display = $name ) =~ s/ /&nbsp;/g;
%     $display .= $item->[1]{note} if ref($item) && $item->[1]{note};
%     my $desc = ref($item) && $item->[1]{desc} ? $item->[1]{desc} : '';
%
%     my $checked;
%     if ( $cgi->param('error') ) {
%
%       $checked = $cgi->param($opt{'link_table'}. ".$name" )
%                    ? 'CHECKED'
%                    : '';
%
%     } else {
%
%       $checked =
%         qsearchs( $opt{'link_table'}, {
%                                         $source_pkey     => $sourcenum,
%                                         $opt{'name_col'} => $name,
%                                         %$link_static,
%                                       }                                 )
%                    ? 'CHECKED'
%                    : ''
%
%     }

  <TR>
    <TD VALIGN="top">
      <INPUT TYPE="checkbox" NAME="<% $opt{'link_table'}. ".$name" %>" <% $checked %> ID="<%$prefix.$num++%>" VALUE="ON">
    </TD>
    <TD><% $display %>
%     if ( $desc ) {
        <BR><FONT SIZE="-2"><% $desc %></FONT>
%     }
    </TD>
  </TR>

% } 

</TABLE>

<SCRIPT TYPE="text/javascript">

  function setAll<%$prefix%>(setTo) {
%   for ( 0 .. ($num-1) ) {
      document.getElementById('<%$prefix.$_%>').checked = setTo;
%   }
  }

  function toggleAll<%$prefix%>(setTo) {
%   for ( 0 .. ($num-1) ) {
      var element = document.getElementById('<%$prefix.$_%>');
      if ( element.checked == true ) {
        element.checked = false;
      } else {
        element.checked = true;
      }
%   }
  }

</SCRIPT>

<%init>

my( %opt ) = @_;

my @pset = ( 'a'..'z', 'A'..'Z', '0'..'9' );

my $prefix = $opt{prefix}
             || join('', map $pset[ int(rand $#pset) ], (0..20) );

my( $source_pkey, $sourcenum, $source_obj );
if ( $opt{'source_obj'} ) {

  $source_obj = $opt{'source_obj'};
  #$source_table = $source_obj->dbdef_table->table;
  $source_pkey = $source_obj->dbdef_table->primary_key;
  $sourcenum = $source_obj->$source_pkey();

} else {

  #$source_obj?
  $source_pkey = $opt{'source_table'}
                   ? dbdef->table($opt{'source_table'})->primary_key
                   : '';
  $sourcenum = $opt{'sourcenum'};
}

$source_pkey = $opt{'num_col'} || $source_pkey;

my $link_static = $opt{'link_static'} || {};

</%init>
