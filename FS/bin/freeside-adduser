#!/usr/bin/perl -w
#
# $Id: freeside-adduser,v 1.3 2001-10-30 13:47:07 ivan Exp $

use strict;
use vars qw($opt_h $opt_c $opt_s);
use Getopt::Std;

my $FREESIDE_CONF = "/usr/local/etc/freeside";

getopts("ch:s:");
die &usage if $opt_c && ! $opt_h;
my $user = shift or die &usage;

my @args = ( 'htpasswd' );
push @args, '-c' if $opt_c;
push @args, $opt_h, $user;
system(@args) == 0 or die "htpasswd failed: $?";

my $secretfile = $opt_s || 'secrets';

open(MAPSECRETS,">>$FREESIDE_CONF/mapsecrets")
  or die "can't open $FREESIDE_CONF/mapsecrets: $!";
print MAPSECRETS "$user $secretfile\n";
close MAPSECRETS or die "can't close $FREESIDE_CONF/mapsecrets: $!";

sub usage {
  die "Usage:\n\n  freeside-adduser [ -h htpasswd_file [ -c ] ] [ -s secretfile ] username"
}

=head1 NAME

freeside-adduser - Command line interface to add (freeside) users.

=head1 SYNOPSIS

  freeside-adduser [ -h htpasswd_file [ -c ] ] [ -s secretfile ] username

=head1 DESCRIPTION

Adds a user to the Freeside billing system.  This is for adding users (internal
sales/tech folks) to the web interface, not for adding customer accounts.

  -h: Also call htpasswd for this user with the given filename

  -c: Passed to htpasswd

  -s: Specify an alternate secret file

=head1 SEE ALSO

L<htpasswd>, base Freeside documentation

=cut

