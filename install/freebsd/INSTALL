#!/bin/sh

( cd /usr/ports/sysutils/portupgrade
  #??? setenv WITH_OPENSSL_PORT "yes"
  make install
)

#rehash
pkgdb -u

portinstall -PR cvsup-without-gui

cp /usr/share/examples/cvsup/ports-supfile /root
perl -pi -e 's/CHANGE_THIS/cvsup13/;' /root/ports-supfile
cvsup /root/ports-supfile

portsdb -Uu

portinstall -PR portupgrade

portinstall -PR lang/perl5.8
/usr/local/bin/use.perl port

for port in `grep -v '^ *#' ports`; do
  #cd /usr/ports/$port
  #make install || exit
  portinstall -P -R $port || exit
done

for a in JavaScript::RPC::Server::CGI Chart::LinesPoints Frontier::RPC2; do perl -MCPAN -e"install $a"; done

su -l pgsql -c initdb

/usr/local/etc/rc.d/010.pgsql.sh start

pw user add freeside -m

su -l pgsql -c 'createuser -P freeside'

su -l freeside -c 'createdb freeside'

#?
cd ../..
make install-perl-modules
make create-config
freeside-adduser -c -h /usr/local/etc/freeside/htpasswd ivan
su freeside -c 'freeside-setup ivan'
su freeside -c '/home/ivan/freeside/bin/populate-msgcat ivan'
make deploy

#edit apache config, etc.

#mkdir /etc/rc.conf.d
#add these to /etc/rc.conf.d/apache
#apache_enable="YES"
#apache_flags="-DSSL"


